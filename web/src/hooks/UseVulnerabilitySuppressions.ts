import {useQuery} from '@tanstack/react-query';
import {AxiosError} from 'axios';
import {
  ManifestVulnerabilitySuppressionsResponse,
  getManifestVulnerabilitySuppressions,
} from 'src/resources/TagResource';

export function useManifestVulnerabilitySuppressions(
  org: string,
  repo: string,
  digest: string,
) {
  const {
    data: suppressionsResponse,
    isLoading: loadingSuppressions,
    isError: errorLoadingSuppressions,
    error: errorManifestVulnerabilitySuppressions,
  } = useQuery(
    ['manifestvulnsuppressions', org, 'repo', repo, 'digest', digest],
    () => getManifestVulnerabilitySuppressions(org, repo, digest),
  ) as {
    data: ManifestVulnerabilitySuppressionsResponse;
    isLoading: boolean;
    isError: boolean;
    error: AxiosError | null;
  };

  const suppressions = suppressionsResponse?.suppressed_vulnerabilities || [];

  return {
    suppressions: suppressions,
    loadingSuppressions: loadingSuppressions,
    errorLoadingSuppressions: errorLoadingSuppressions,
    errorLoaddingSuppressionsDetails: errorManifestVulnerabilitySuppressions,
  };
}
